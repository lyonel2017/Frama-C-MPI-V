/**
 * An example protocol for a program that calculates the dot product of two
 * vectors.
 *
 * Adapted from:
 *   P.S. Pacheco. Parallel Programming with MPI. Morgan Kaufmann, 1997.
 *   parallel_dot1.c example, Chap.5, p.76
 *
 * Authors: CÃ©sar Santos and Eduardo Marques
 * Version: $Id: parallelDot.prot 4495 2015-05-08 21:37:32Z csantos $
 * ParTypes - http://gloss.di.fc.ul.pt/ParTypes
 */
protocol parallel_dot  {
  broadcast 0 n:{ x: positive | x % size = 0 }
  foreach i: 1 .. size-1 {
    message 0  i float[n/size]
  }
  foreach i: 1 .. size-1 {
    message 0 i float[n/size]
  }
  allreduce sum float
  foreach i: 1 .. size-1 {
    message i  0 float
  }
}