/**
 * An example protocol for the N-body simulation pipeline algorithm.
 *
 * Adapted from:
 *   William Gropp, Ewing Lusk, and Anthony Skjellum. "Using MPI (2nd Ed.): 
 *   Portable Parallel Programming with the Message-passing Interface". MIT Press, 1999
 *   http://www.mcs.anl.gov/research/projects/mpi/usingmpi/examples-usingmpi/advmsg/nbodypipe_c.html
 *
 * Authors: CÃ©sar Santos and Eduardo Marques
 * Version: $Id: nbodypipe.prot 4635 2015-06-09 14:05:04Z edrdo $
 * ParTypes - http://gloss.di.fc.ul.pt
 */
protocol nbodypipe (size > 1) {
  val n: {x: natural | x % size = 0}
  val numIterations : { x : natural | x > 0}
  foreach iter:1..numIterations {
  	foreach pipe:1..size-1 {
      foreach i:0..size-1 {
        message i (i + 1 < size ? i+1 : 0) float[(n/size) * 4]
      }
    }
    allreduce min float
  }
}
